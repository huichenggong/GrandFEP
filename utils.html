<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>utils &#8212; GrandFEP  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=3f530b75" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=fd3c8104" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="GrandFEP CLI" href="commandline.html" />
    <link rel="prev" title="NPTSamplerMPI" href="sampler/NPTSamplerMPI.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">GrandFEP</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=huichenggong&repo=GrandFEP&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial/tutorial.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">GrandFEP API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sampler.html">sampler</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">utils</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="commandline.html">GrandFEP CLI</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="modules.html">GrandFEP API</a><ul>
      <li>Previous: <a href="sampler/NPTSamplerMPI.html" title="previous chapter">NPTSamplerMPI</a></li>
      <li>Next: <a href="commandline.html" title="next chapter">GrandFEP CLI</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-grandfep.utils">
<span id="utils"></span><h1>utils<a class="headerlink" href="#module-grandfep.utils" title="Link to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="grandfep.utils.FreeEAnalysis">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">FreeEAnalysis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keyword</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">drop_equil</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">begin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.FreeEAnalysis" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Class to analyze free energy calculations using BAR/MBAR.</p>
<dl class="py method">
<dt class="sig sig-object py" id="grandfep.utils.FreeEAnalysis.print_res_all">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">print_res_all</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">res_all</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.FreeEAnalysis.print_res_all" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.utils.FreeEAnalysis.read_energy">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">read_energy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">log_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keyword</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Reduced</span> <span class="pre">Energy</span> <span class="pre">U_i(x):'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">','</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">begin</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.FreeEAnalysis.read_energy" title="Link to this definition">¶</a></dt>
<dd><p>Parse the energy from a file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>log_file</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code>]</span>) – File to be parsed</p></li>
<li><p><strong>keyword</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – The keyword to locate the line. The energy should immediately follow this keyword.</p></li>
<li><p><strong>separator</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – The separator to use between energy in the file</p></li>
<li><p><strong>begin</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – The first frame to be analyzed. The first frame is 0.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>e_array</strong> (<em>np.array</em>) – The energy array.</p></li>
<li><p><strong>temperature</strong> (<em>unit.Quantity</em>) – The temperature in Kelvin. If not found, None is returned.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.utils.FreeEAnalysis.bar_U_all">
<span class="sig-name descname"><span class="pre">bar_U_all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.FreeEAnalysis.bar_U_all" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.utils.FreeEAnalysis.mbar_U_all">
<span class="sig-name descname"><span class="pre">mbar_U_all</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.FreeEAnalysis.mbar_U_all" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.utils.FreeEAnalysis.print_uncorrelate">
<span class="sig-name descname"><span class="pre">print_uncorrelate</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.FreeEAnalysis.print_uncorrelate" title="Link to this definition">¶</a></dt>
<dd><p>Print the number of uncorrelated sample in each file</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.utils.FreeEAnalysis.set_temperature">
<span class="sig-name descname"><span class="pre">set_temperature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">temperature</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.FreeEAnalysis.set_temperature" title="Link to this definition">¶</a></dt>
<dd><p>Set the temperature for the analysis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>temperature</strong> (<em>unit.Quantity</em>) – Temperature in Kelvin, with unit</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.utils.FreeEAnalysis.sub_sample">
<span class="sig-name descname"><span class="pre">sub_sample</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">drop_equil</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.FreeEAnalysis.sub_sample" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="grandfep.utils.dcd_reporter">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">dcd_reporter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reportInterval</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">append</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enforcePeriodicBox</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.dcd_reporter" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">DCDReporter</span></code></p>
<p>A custom DCD reporter that can report from coordinate np.array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file</strong> (<em>string</em>) – The file to write to</p></li>
<li><p><strong>reportInterval</strong> (<em>int</em>) – The interval (in time steps) at which to write frames</p></li>
<li><p><strong>append</strong> (<em>bool=False</em>) – If True, open an existing DCD file to append to.  If False, create a new file.</p></li>
<li><p><strong>enforcePeriodicBox</strong> (<em>bool</em>) – Specifies whether particle positions should be translated so the center of every molecule
lies in the same periodic box.  If None (the default), it will automatically decide whether
to translate molecules based on whether the system being simulated uses periodic boundary
conditions.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="grandfep.utils.dcd_reporter.report_positions">
<span class="sig-name descname"><span class="pre">report_positions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">simulation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periodicBoxVectors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">positions_nm</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.dcd_reporter.report_positions" title="Link to this definition">¶</a></dt>
<dd><p>Write one frame to the DCD file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>simulation</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.app.simulation.Simulation</span></code></span>) – The Simulation to generate a report for</p></li>
<li><p><strong>periodicBoxVectors</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.vec3.Vec3</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.array</span></code>]</span>) – You can prepare this np.array with <code class="docutils literal notranslate"><span class="pre">state.getPeriodicBoxVectors()</span></code></p></li>
<li><p><strong>positions_nm</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>]</span>) – You can prepare this np.array with <code class="docutils literal notranslate"><span class="pre">state.getPositions(asNumpy=True).value_in_unit(unit.nanometers)</span></code>.
It should either be <code class="docutils literal notranslate"><span class="pre">unit.Quantity</span></code> or value in nm.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">md_params_yml</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">yml_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.md_params_yml" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Class to manage MD parameters with default values and YAML overrides. This class reads whatever in the yml file, and
it does not guarantee the correct usage of the parameters anywhere else. The built-in parameters in
<code class="docutils literal notranslate"><span class="pre">self._unit_map</span></code> will be automatically added with units. If you want a unit to be attached, you can add it to
<code class="docutils literal notranslate"><span class="pre">self._unit_map</span></code> before loading the yml file.</p>
<section id="example">
<h2>Example:<a class="headerlink" href="#example" title="Link to this heading">¶</a></h2>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">grandfep</span><span class="w"> </span><span class="kn">import</span> <span class="n">utils</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mdp</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">md_params_yml</span><span class="p">(</span><span class="s2">&quot;test/Water_Chemical_Potential/OPC/multidir/0/md.yml&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.integrator">
<span class="sig-name descname"><span class="pre">integrator</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.integrator" title="Link to this definition">¶</a></dt>
<dd><p>Name of the integrator.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.dt">
<span class="sig-name descname"><span class="pre">dt</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.dt" title="Link to this definition">¶</a></dt>
<dd><p>Time step. Unit in ps</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>unit.Quantity</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.nsteps">
<span class="sig-name descname"><span class="pre">nsteps</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.nsteps" title="Link to this definition">¶</a></dt>
<dd><p>Number of steps.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.nst_dcd">
<span class="sig-name descname"><span class="pre">nst_dcd</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.nst_dcd" title="Link to this definition">¶</a></dt>
<dd><p>Number of steps per dcd trajectory output.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.nst_csv">
<span class="sig-name descname"><span class="pre">nst_csv</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.nst_csv" title="Link to this definition">¶</a></dt>
<dd><p>Number of steps per csv energy file output.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.ncycle_dcd">
<span class="sig-name descname"><span class="pre">ncycle_dcd</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.ncycle_dcd" title="Link to this definition">¶</a></dt>
<dd><p>Number of cycles per dcd trajectory output.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.ncycle_csv">
<span class="sig-name descname"><span class="pre">ncycle_csv</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.ncycle_csv" title="Link to this definition">¶</a></dt>
<dd><p>Number of cycles per csv energy file output.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.tau_t">
<span class="sig-name descname"><span class="pre">tau_t</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.tau_t" title="Link to this definition">¶</a></dt>
<dd><p>Temperature coupling time constant. Unit in ps</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>unit.Quantity</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.ref_t">
<span class="sig-name descname"><span class="pre">ref_t</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.ref_t" title="Link to this definition">¶</a></dt>
<dd><p>Reference temperature. Unit in K</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>unit.Quantity</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.gen_vel">
<span class="sig-name descname"><span class="pre">gen_vel</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.gen_vel" title="Link to this definition">¶</a></dt>
<dd><p>Generate velocities.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.gen_temp">
<span class="sig-name descname"><span class="pre">gen_temp</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.gen_temp" title="Link to this definition">¶</a></dt>
<dd><p>Temperature for random velocity generation. Unit in K</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>unit.Quantity</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.restraint">
<span class="sig-name descname"><span class="pre">restraint</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.restraint" title="Link to this definition">¶</a></dt>
<dd><p>Whether to apply restraints.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.restraint_fc">
<span class="sig-name descname"><span class="pre">restraint_fc</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.restraint_fc" title="Link to this definition">¶</a></dt>
<dd><p>Restraint force constant. Unit in kJ/mol/nm^2</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>unit.Quantity</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.pcoupltype">
<span class="sig-name descname"><span class="pre">pcoupltype</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.pcoupltype" title="Link to this definition">¶</a></dt>
<dd><p>Specifies the kind of pressure coupling used. MonteCarloBarostat, MonteCarloMembraneBarostat</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.ref_p">
<span class="sig-name descname"><span class="pre">ref_p</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.ref_p" title="Link to this definition">¶</a></dt>
<dd><p>Reference pressure. Unit in bar</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>unit.Quantity</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.nstpcouple">
<span class="sig-name descname"><span class="pre">nstpcouple</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.nstpcouple" title="Link to this definition">¶</a></dt>
<dd><p>Pressure coupling frequency.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.surface_tension">
<span class="sig-name descname"><span class="pre">surface_tension</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.surface_tension" title="Link to this definition">¶</a></dt>
<dd><p>Surface tension. Unit in bar*nm</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>unit.Quantity</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.ex_potential">
<span class="sig-name descname"><span class="pre">ex_potential</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.ex_potential" title="Link to this definition">¶</a></dt>
<dd><p>Excess potential in GC. Unit in kcal/mol</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>unit.Quantity</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.standard_volume">
<span class="sig-name descname"><span class="pre">standard_volume</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.standard_volume" title="Link to this definition">¶</a></dt>
<dd><p>Standard volume in GC. Unit in nm^3</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>unit.Quantity</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.n_propagation">
<span class="sig-name descname"><span class="pre">n_propagation</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.n_propagation" title="Link to this definition">¶</a></dt>
<dd><p>Number of propagation steps bewteen each lambda switching.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.init_lambda_state">
<span class="sig-name descname"><span class="pre">init_lambda_state</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.init_lambda_state" title="Link to this definition">¶</a></dt>
<dd><p>The lambda state index to simulate</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.calc_neighbor_only">
<span class="sig-name descname"><span class="pre">calc_neighbor_only</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.calc_neighbor_only" title="Link to this definition">¶</a></dt>
<dd><p>Whether to calculate the energy of the nearest neighbor only
when performing replica exchange.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.md_gc_re_protocol">
<span class="sig-name descname"><span class="pre">md_gc_re_protocol</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.md_gc_re_protocol" title="Link to this definition">¶</a></dt>
<dd><p>MD, Grand Canonical, Replica Exchange protocol. The default is
<code class="docutils literal notranslate"><span class="pre">[(&quot;MD&quot;,</span> <span class="pre">200),(&quot;GC&quot;,</span> <span class="pre">1),(&quot;MD&quot;,</span> <span class="pre">200),(&quot;RE&quot;,</span> <span class="pre">1),(&quot;MD&quot;,</span> <span class="pre">200),(&quot;RE&quot;,</span> <span class="pre">1),(&quot;MD&quot;,</span> <span class="pre">200),(&quot;RE&quot;,</span> <span class="pre">1)]</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.system_setting">
<span class="sig-name descname"><span class="pre">system_setting</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.system_setting" title="Link to this definition">¶</a></dt>
<dd><p>Nonbonded parameters for the OpenMM createSystem. The default is
<code class="docutils literal notranslate"><span class="pre">{&quot;nonbondedMethod&quot;:</span> <span class="pre">app.PME,</span> <span class="pre">&quot;nonbondedCutoff&quot;:</span> <span class="pre">1.0</span> <span class="pre">*</span> <span class="pre">unit.nanometer,</span> <span class="pre">&quot;constraints&quot;:</span> <span class="pre">app.HBonds}</span></code>.
openmm has to be imported in the way the the value string can be evaluated.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">openmm</span><span class="w"> </span><span class="kn">import</span> <span class="n">app</span><span class="p">,</span> <span class="n">openmm</span><span class="p">,</span> <span class="n">unit</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.sphere_radius">
<span class="sig-name descname"><span class="pre">sphere_radius</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.sphere_radius" title="Link to this definition">¶</a></dt>
<dd><p>The radius of the GCMC sphere. Unit in nm</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>unit.Quantity</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.lambda_gc_vdw">
<span class="sig-name descname"><span class="pre">lambda_gc_vdw</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.lambda_gc_vdw" title="Link to this definition">¶</a></dt>
<dd><p>This is the ghobal parameter for controlling the vdw on the switching water. You
can give a list of lambda values for the path of GC insertion.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.lambda_gc_coulomb">
<span class="sig-name descname"><span class="pre">lambda_gc_coulomb</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.lambda_gc_coulomb" title="Link to this definition">¶</a></dt>
<dd><p>This is the ghobal parameter for controlling the Coulomb on the switching water. You
can give a list of lambda values for the path of GC insertion.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.lambda_angles">
<span class="sig-name descname"><span class="pre">lambda_angles</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.lambda_angles" title="Link to this definition">¶</a></dt>
<dd><p>Lambda</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.lambda_bonds">
<span class="sig-name descname"><span class="pre">lambda_bonds</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.lambda_bonds" title="Link to this definition">¶</a></dt>
<dd><p>Lambda</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.lambda_sterics_core">
<span class="sig-name descname"><span class="pre">lambda_sterics_core</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.lambda_sterics_core" title="Link to this definition">¶</a></dt>
<dd><p>Lambda</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.lambda_electrostatics_core">
<span class="sig-name descname"><span class="pre">lambda_electrostatics_core</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.lambda_electrostatics_core" title="Link to this definition">¶</a></dt>
<dd><p>Lambda</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.lambda_sterics_delete">
<span class="sig-name descname"><span class="pre">lambda_sterics_delete</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.lambda_sterics_delete" title="Link to this definition">¶</a></dt>
<dd><p>Lambda</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.lambda_electrostatics_delete">
<span class="sig-name descname"><span class="pre">lambda_electrostatics_delete</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.lambda_electrostatics_delete" title="Link to this definition">¶</a></dt>
<dd><p>Lambda</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.lambda_sterics_insert">
<span class="sig-name descname"><span class="pre">lambda_sterics_insert</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.lambda_sterics_insert" title="Link to this definition">¶</a></dt>
<dd><p>Lambda</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.lambda_electrostatics_insert">
<span class="sig-name descname"><span class="pre">lambda_electrostatics_insert</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.lambda_electrostatics_insert" title="Link to this definition">¶</a></dt>
<dd><p>Lambda</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.lambda_torsions">
<span class="sig-name descname"><span class="pre">lambda_torsions</span></span><a class="headerlink" href="#grandfep.utils.md_params_yml.lambda_torsions" title="Link to this definition">¶</a></dt>
<dd><p>Lambda</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.get_lambda_dict">
<span class="sig-name descname"><span class="pre">get_lambda_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.md_params_yml.get_lambda_dict" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A dictionary of mapping from global parameters to their values in all the sampling states.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>lambda_dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.utils.md_params_yml.get_system_setting">
<span class="sig-name descname"><span class="pre">get_system_setting</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.md_params_yml.get_system_setting" title="Link to this definition">¶</a></dt>
<dd><p>Evaluate system_setting, and return them in a dictionary</p>
</dd></dl>

</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="grandfep.utils.rst7_reporter">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">rst7_reporter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reportInterval</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">write_multiple</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">netcdf</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">write_velocities</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.rst7_reporter" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">RestartReporter</span></code></p>
<p>A reporter to handle writing Amber rst7 restart files.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file</strong> (<em>str</em>) – Name of the file to write the restart to.</p></li>
<li><p><strong>reportInterval</strong> (<em>int</em>) – Number of steps between writing restart files</p></li>
<li><p><strong>write_multiple</strong> (<em>bool=False</em>) – Either write a separate restart each time (appending the step number in
the format .# to the file name given above) if True, or overwrite the
same file each time if False</p></li>
<li><p><strong>netcdf</strong> (<em>bool=False</em>) – Use the Amber NetCDF restart file format</p></li>
<li><p><strong>write_velocities</strong> (<em>bool=True</em>) – Write velocities to the restart file. You can turn this off for passing
in, for instance, a minimized structure.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="grandfep.utils.rst7_reporter.report_positions_velocities">
<span class="sig-name descname"><span class="pre">report_positions_velocities</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periodicBoxVectors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">positions_A</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">velocities</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.rst7_reporter.report_positions_velocities" title="Link to this definition">¶</a></dt>
<dd><p>Generate a report.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sim</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.app.simulation.Simulation</span></code></span>) – The Simulation to generate a report for</p></li>
<li><p><strong>state</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.openmm.State</span></code></span>) – The current state of the simulation. Only the time will be read from this state.</p></li>
<li><p><strong>periodicBoxVectors</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.vec3.Vec3</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.array</span></code>]</span>) – You can prepare this np.array with <code class="docutils literal notranslate"><span class="pre">state.getPeriodicBoxVectors()</span></code></p></li>
<li><p><strong>positions_A</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>]</span>) – You can prepare this np.array with <code class="docutils literal notranslate"><span class="pre">state.getPositions(asNumpy=True).value_in_unit(unit.angstrom)</span></code>.
It should either be <code class="docutils literal notranslate"><span class="pre">unit.Quantity</span></code> or value in Angstrom.</p></li>
<li><p><strong>velocities</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>]</span>) – You can prepare this np.array with <code class="docutils literal notranslate"><span class="pre">state.getVelocities(asNumpy=True).value_in_unit(unit.angstrom/unit.picosecond)</span></code>.
It should either be <code class="docutils literal notranslate"><span class="pre">unit.Quantity</span></code> or value in Angstrom/ps.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="grandfep.utils.find_mapping">
<span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">find_mapping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">map_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resA</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">resB</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.find_mapping" title="Link to this definition">¶</a></dt>
<dd><p>Check if residues A and B match with a mapping in the mapping list.</p>
<section id="parameter">
<h2>Parameter<a class="headerlink" href="#parameter" title="Link to this heading">¶</a></h2>
<dl>
<dt>map_list :</dt><dd><p>A list of mapping. For example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="s1">&#39;res_nameA&#39;</span><span class="p">:</span> <span class="s1">&#39;MOL&#39;</span><span class="p">,</span>
  <span class="s1">&#39;res_nameB&#39;</span><span class="p">:</span> <span class="s1">&#39;MOL&#39;</span><span class="p">,</span>
  <span class="s1">&#39;index_map&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
 <span class="p">}]</span>
</pre></div>
</div>
</dd>
<dt>resA :</dt><dd><p>residue from state A</p>
</dd>
<dt>resB :</dt><dd><p>residue from state B</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">rtype<span class="colon">:</span></dt>
<dd class="field-odd"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>]</span></p>
</dd>
<dt class="field-even">returns<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><em>match_flag</em> – resA and resB can be matched</p></li>
<li><p><em>index_map</em> – A dictionay mapping the atoms from state A to state B with their 0-index</p></li>
</ul>
</dd>
</dl>
</section>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="grandfep.utils.find_reference_atom_indices">
<span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">find_reference_atom_indices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ref_atoms_list</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.find_reference_atom_indices" title="Link to this definition">¶</a></dt>
<dd><p>Find atom indices in the topology that match the given reference atom definitions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topology</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.app.topology.Topology</span></code></span>) – OpenMM topology object</p></li>
<li><p><strong>ref_atoms_list</strong> (<em>list</em>) – <p>A list of dictionaries specifying reference atoms.
Each dictionary can contain any combination of the following keys:</p>
<ul>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">chain_index</span></code>: int</dt><dd><p>Index of the chain in the topology.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">res_name</span></code>: str</dt><dd><p>Residue name (e.g., “HOH”).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">res_id</span></code>: str</dt><dd><p>In openmm topology, res_id is string.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">res_index</span></code>: int</dt><dd><p>0-based index of the residue in the topology.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">atom_name</span></code>: str</dt><dd><p>Atom name (e.g., “O”, “H1”).</p>
</dd>
</dl>
</li>
</ul>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of integer atom indices matching the provided atom specifications.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">grandfep</span><span class="w"> </span><span class="kn">import</span> <span class="n">utils</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">top</span> <span class="o">=</span> <span class="s2">&quot;test/KcsA_5VKE_SF/step1_pdbreader_12WAT.psf&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">topology</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">load_top</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ref_atoms_list</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;res_id&quot;</span><span class="p">:</span><span class="s2">&quot;71&quot;</span><span class="p">,</span> <span class="s2">&quot;res_name&quot;</span><span class="p">:</span><span class="s2">&quot;GLU&quot;</span><span class="p">,</span> <span class="s2">&quot;atom_name&quot;</span><span class="p">:</span><span class="s2">&quot;O&quot;</span><span class="p">}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">utils</span><span class="o">.</span><span class="n">find_reference_atom_indices</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">ref_atoms_list</span><span class="p">)</span>
<span class="go">[21, 164, 307, 450]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="grandfep.utils.load_sys">
<span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">load_sys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sys_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.load_sys" title="Link to this definition">¶</a></dt>
<dd><p>Load a serialized OpenMM system from a xml or xml.gz file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>sys_file</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code>]</span>) – Path to the serialized OpenMM system file (.xml or .xml.gz).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The deserialized OpenMM System object.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>openmm.System</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="kn">from</span><span class="w"> </span><span class="nn">grandfep</span><span class="w"> </span><span class="kn">import</span> <span class="n">utils</span>
<span class="linenos">2</span><span class="n">system</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">load_sys</span><span class="p">(</span><span class="s2">&quot;system.xml.gz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="grandfep.utils.load_top">
<span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">load_top</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">top_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.load_top" title="Link to this definition">¶</a></dt>
<dd><p>Load a topology file in PSF (CHARMM) or PRMTOP/PARM7 (AMBER) format.</p>
<p>After loading a top file, you should call <cite>.setPeriodicBoxVectors()</cite> on the topology object
to define the box. Without setting the box, trajectory files may lack box information.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>top_file</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code>]</span>) – Path to the topology file (either .psf, .prmtop, or .parm7).</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.app.topology.Topology</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.app.charmmpsffile.CharmmPsfFile</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.app.amberprmtopfile.AmberPrmtopFile</span></code>]]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>topology</strong> (<em>openmm.app.Topology</em>) – The OpenMM Topology object for use in simulation setup.</p></li>
<li><p><strong>top_object</strong> (<em>openmm.app.CharmmPsfFile or openmm.app.AmberPrmtopFile</em>) – The loaded OpenMM file object used to construct the topology.</p></li>
</ul>
</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If the file format is not supported. Only the extensions .psf, .prmtop, and .parm7 are supported.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="grandfep.utils.period_from_k_mu">
<span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">period_from_k_mu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mu</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.period_from_k_mu" title="Link to this definition">¶</a></dt>
<dd><p>Calculate the period T from spring constant k and reduced mass mu. Please make sure k and mu have the proper units.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>k</strong> (<em>spring constant</em><em> (</em><em>energy/distance^2</em><em>)</em><em>, </em><em>e.g. kJ/mol/nm^2</em>)</p></li>
<li><p><strong>mu</strong> (<em>reduced mass</em><em> (</em><em>mass</em><em>)</em><em>, </em><em>e.g. dalton</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>T</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="grandfep.utils.prepare_atom_map">
<span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">prepare_atom_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">topologyA</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topologyB</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">map_list</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.prepare_atom_map" title="Link to this definition">¶</a></dt>
<dd><p>With given topology A and B, prepare the atom mapping.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topologyA</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.app.topology.Topology</span></code></span>) – topology for state A</p></li>
<li><p><strong>topologyB</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.app.topology.Topology</span></code></span>) – topology for state B</p></li>
<li><p><strong>map_list</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></span>) – <p>A list of mapping. For example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span><span class="s1">&#39;res_nameA&#39;</span><span class="p">:</span> <span class="s1">&#39;MOL&#39;</span><span class="p">,</span> <span class="s1">&#39;res_nameB&#39;</span><span class="p">:</span> <span class="s1">&#39;MOL&#39;</span><span class="p">,</span>
  <span class="s1">&#39;index_map&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">25</span><span class="p">:</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">22</span><span class="p">:</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">23</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">24</span><span class="p">:</span> <span class="mi">27</span><span class="p">}</span>
</pre></div>
</div>
</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>old_to_new_all</em> – A dictionay for all the atoms that should map from old (state A) to new (state B)</p></li>
<li><p><em>old_to_new_core</em> – A dictionay for Alchemical (core) atoms that should map from old (state A) to new (state B)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="grandfep.utils.prepare_restraints_force">
<span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">prepare_restraints_force</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">positions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">solvent_resname</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.prepare_restraints_force" title="Link to this definition">¶</a></dt>
<dd><p>Prepare a force to add position restraints to heavy atoms. 1/2 * k * (x - x0)^2</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>topology</strong> (<em>openmm.app.Topology</em>) – The OpenMM topology object.</p></li>
<li><p><strong>positions</strong> (<em>openmm.unit.Quantity</em>) – The reference positions of the atoms in the system.</p></li>
<li><p><strong>fc</strong> (<em>openmm.unit.Quantity</em>) – The force constant for the position restraints. Unit in kJ/mol/nm^2.</p></li>
<li><p><strong>solvent_resname</strong> (<em>list</em>) – The residue name of water molecules to be excluded from the restraints. Default is “HOH”, “Na+”, “K+”, “Cl-“.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>posres</em> – An OpenMM CustomExternalForce object for position restraints.</p></li>
<li><p><strong>res_atom_count</strong> (<em>int</em>) – The number of atoms in the system that are restrained.</p></li>
<li><p><strong>res_residue_list</strong> (<em>list</em>) – A list of residue names that are restrained.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="grandfep.utils.random_rotation_matrix">
<span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">random_rotation_matrix</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.random_rotation_matrix" title="Link to this definition">¶</a></dt>
<dd><p>Generate a random rotation matrix using Shoemake method.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A 3x3 rotation matrix.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>np.ndarray</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="linenos"> 2</span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="linenos"> 3</span><span class="kn">from</span><span class="w"> </span><span class="nn">grandfep</span><span class="w"> </span><span class="kn">import</span> <span class="n">utils</span>
<span class="linenos"> 4</span><span class="k">def</span><span class="w"> </span><span class="nf">gen_random_vec</span><span class="p">():</span>
<span class="linenos"> 5</span>    <span class="n">axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="linenos"> 6</span>    <span class="n">axis</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
<span class="linenos"> 7</span>    <span class="k">return</span> <span class="n">axis</span>
<span class="linenos"> 8</span><span class="n">res_new</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 9</span><span class="n">res_ref</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">10</span><span class="n">vec_init</span> <span class="o">=</span> <span class="n">gen_random_vec</span><span class="p">()</span> <span class="c1"># regardless of the initial vector, the rotated vector should have uniform distribution on x,y,z</span>
<span class="linenos">11</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span>
<span class="linenos">12</span>    <span class="n">rot_matrix</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">random_rotation_matrix</span><span class="p">()</span>
<span class="linenos">13</span>    <span class="n">res_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rot_matrix</span><span class="p">,</span> <span class="n">vec_init</span><span class="p">))</span>
<span class="linenos">14</span>    <span class="n">res_ref</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gen_random_vec</span><span class="p">())</span>
<span class="linenos">15</span><span class="n">res_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res_new</span><span class="p">)</span>
<span class="linenos">16</span><span class="n">res_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res_ref</span><span class="p">)</span>
<span class="linenos">17</span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="linenos">18</span><span class="k">for</span> <span class="n">res</span><span class="p">,</span> <span class="n">ax_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">res_new</span><span class="p">,</span> <span class="n">res_ref</span><span class="p">],</span> <span class="n">axes</span><span class="p">):</span>
<span class="linenos">19</span>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax_list</span><span class="p">):</span>
<span class="linenos">20</span>        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">res</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="grandfep.utils.random_rotation_matrix_protoms">
<span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">random_rotation_matrix_protoms</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.random_rotation_matrix_protoms" title="Link to this definition">¶</a></dt>
<dd><p>Copied from <a class="reference external" href="https://github.com/essex-lab/grand/blob/master/grand/utils.py">https://github.com/essex-lab/grand/blob/master/grand/utils.py</a>. Possibly be wrong.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A 3x3 rotation matrix.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="grandfep.utils.reduced_mass">
<span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">reduced_mass</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">m1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">m2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.reduced_mass" title="Link to this definition">¶</a></dt>
<dd><p>(m1*m2)/(m1+m2). Reduced mass for frequency calculation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>m1</strong> (<em>mass</em><em> of </em><em>particle 1</em>)</p></li>
<li><p><strong>m2</strong> (<em>mass</em><em> of </em><em>particle 2</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>reduced_mass</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="grandfep.utils.seconds_to_hms">
<span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">seconds_to_hms</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seconds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.seconds_to_hms" title="Link to this definition">¶</a></dt>
<dd><p>Convert seconds to hours, minutes, and seconds.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>seconds</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></span>) – Time in seconds.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>hours</em></p></li>
<li><p><em>minutes</em></p></li>
<li><p><em>seconds</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="grandfep.utils.HybridTopologyFactoryREST2">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">grandfep.utils.</span></span><span class="sig-name descname"><span class="pre">HybridTopologyFactoryREST2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">old_system</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_positions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_system</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_positions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_to_new_atom_map</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_to_new_core_atom_map</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_rest2_atom_indices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dispersion_correction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">softcore_alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_dihe</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.HybridTopologyFactoryREST2" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This class can add REST2 when creating a hybrid topology.</p>
<p>Atoms in the resulting hybrid system are treated as being from one
of four possible types:</p>
<dl class="simple">
<dt>unique_old_atom<span class="classifier">These atoms are not mapped and only present in the old</span></dt><dd><p>system. Their interactions will be on for lambda=0, off for lambda=1</p>
</dd>
<dt>unique_new_atom<span class="classifier">These atoms are not mapped and only present in the new</span></dt><dd><p>system. Their interactions will be off for lambda=0, on for lambda=1</p>
</dd>
<dt>core_atom<span class="classifier">These atoms are mapped between the two end states, and are</span></dt><dd><p>part of a residue that is changing alchemically. Their interactions
will be those corresponding to the old system at lambda=0, and those
corresponding to the new system at lambda=1</p>
</dd>
<dt>environment_atom<span class="classifier">These atoms are mapped between the two end states, and</span></dt><dd><p>are not part of a residue undergoing an alchemical change. Their
interactions are always on and are alchemically unmodified.</p>
</dd>
</dl>
<p>All the alchemically changed atoms (core, unique_old, unique_new) will be considered “hot” in REST2.
Other atoms in the environment can also be added by <cite>old_rest2_region_atom_indices</cite></p>
<section id="properties">
<h2>Properties<a class="headerlink" href="#properties" title="Link to this heading">¶</a></h2>
<dl class="simple">
<dt>hybrid_system<span class="classifier">openmm.System</span></dt><dd><p>The hybrid system for simulation</p>
</dd>
<dt>new_to_hybrid_atom_map<span class="classifier">dict of int</span><span class="classifier">int</span></dt><dd><p>The mapping of new system atoms to hybrid atoms</p>
</dd>
<dt>old_to_hybrid_atom_map<span class="classifier">dict of int</span><span class="classifier">int</span></dt><dd><p>The mapping of old system atoms to hybrid atoms</p>
</dd>
<dt>hybrid_positions<span class="classifier">[n, 3] np.ndarray</span></dt><dd><p>The positions of the hybrid system</p>
</dd>
<dt>hybrid_topology<span class="classifier">mdtraj.Topology</span></dt><dd><p>The topology of the hybrid system</p>
</dd>
<dt>omm_hybrid_topology<span class="classifier">openmm.app.Topology</span></dt><dd><p>The OpenMM topology object corresponding to the hybrid system</p>
</dd>
<dt>Here are the forces in the hybrid system:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>CustomBondForce</dt><dd><p>handles bonds involving <cite>core_atoms</cite> (these are interpolated). REST2 does not change bonds</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>HarmonicBondForce</dt><dd><p>handles bonds involving <cite>environment_atoms</cite>, <cite>unique_old_atoms</cite> and <cite>unique_new_atoms</cite> (these are never scaled)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>CustomAngleForce</dt><dd><p>handles angles involving <cite>core_atoms</cite> (these are interpolated). REST2 does not change angles</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>HarmonicAngleForce</dt><dd><p>handles angles involving <cite>environment_atoms</cite>, <cite>unique_old_atoms</cite> and <cite>unique_new_atoms</cite> (these are never scaled)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>CustomTorsionForce</dt><dd><p>handles torsions involving <cite>core_atoms</cite>, <cite>rest2_atoms</cite>, <cite>unique_old_atoms</cite> and <cite>unique_new_atoms</cite> (these are interpolated).
We are planning to scale d-d-d-d, r-d-d-d and r-r-d-d to 0 in the future</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>PeriodicTorsionForce</dt><dd><p>handles torsions involving <cite>environment_atoms</cite> (these are never scaled)</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>NonbondedForce</dt><dd><p>handles all electrostatic interactions, non-rest2 environment-environment steric interactions</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>CustomNonbondedForce</dt><dd><p>handle all non environment-environment sterics</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>CustomBondForce_exceptions</dt><dd><p>handles all electrostatics and sterics exceptions involving unique old/new atoms when
interpolate_14s is True, otherwise the electrostatics/sterics exception is in the NonbondedForce</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p>where <cite>interactions</cite> refers to any pair of atoms that is not 1-2, 1-3, 1-4</p>
<p>vdW table
+———-+——–+——–+——–+——–+——–+
| Groups   | core   | new    | old    | envh   | envc   |
+==========+========+========+========+========+========+
| 0 core   | C_alc  |        |        |        |        |
+———-+——–+——–+——–+——–+——–+
| 1 new    | C_alc  | C_alc  |        |        |        |
+———-+——–+——–+——–+——–+——–+
| 2 old    | C_alc  | None   | C_alc  |        |        |
+———-+——–+——–+——–+——–+——–+
| 3 envh   | C_alc  | C_alc  | C_alc  | C_alc  |        |
+———-+——–+——–+——–+——–+——–+
| 4 envc   | C_alc  | C_alc  | C_alc  | C_alc  | NonB   |
+———-+——–+——–+——–+——–+——–+</p>
<dl class="py method">
<dt class="sig sig-object py" id="grandfep.utils.HybridTopologyFactoryREST2.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">old_system</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_positions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_system</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_positions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_to_new_atom_map</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_to_new_core_atom_map</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_rest2_atom_indices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_dispersion_correction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">softcore_alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_dihe</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.HybridTopologyFactoryREST2.__init__" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>old_system</strong> – The OpenMM System object of the old state (state A).</p></li>
<li><p><strong>old_positions</strong> – The positions of the old state (state A).</p></li>
<li><p><strong>old_topology</strong> – The OpenMM Topology object of the old state (state A).</p></li>
<li><p><strong>new_system</strong> – The OpenMM System object of the new state (state B).</p></li>
<li><p><strong>new_positions</strong> – The positions of the new state (state B).</p></li>
<li><p><strong>new_topology</strong> – The OpenMM Topology object of the new state (state B).</p></li>
<li><p><strong>old_to_new_atom_map</strong> – All atoms that should map from the old state (A) to new state (B).</p></li>
<li><p><strong>old_to_new_core_atom_map</strong> – Alchemical Atoms that should map from A to B</p></li>
<li><p><strong>old_rest2_atom_indices</strong> – The indices of the atoms in the old system that should be considered as hot in REST2.</p></li>
<li><p><strong>use_dispersion_correction</strong> (<em>bool</em><em>, </em><em>default False</em>) – Whether to use the long range correction in the custom sterics
force. This can be very expensive for derivative.</p></li>
<li><p><strong>softcore_alpha</strong> (<em>float</em><em>, </em><em>default None</em>) – “alpha” parameter of softcore sterics, default 0.5.</p></li>
<li><p><strong>scale_dihe</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></span>) – A dictionary defining the dummy atom scaling factors for dihedrals with different periodicities.
Keys are periodicities (1, 2, 3, etc.), and values are the corresponding scaling factors.
default is scale_dihe={ 1: 0.1, “i1”: 0.1, 2: 1.0, “i2”: 1.0, 3: 0.1, “i3”: 0.1, 4: 0.1, “i4”: 0.1, 5: 0.1, “i5”: 0.1,}.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.utils.HybridTopologyFactoryREST2._handle_nonbonded">
<span class="sig-name descname"><span class="pre">_handle_nonbonded</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.utils.HybridTopologyFactoryREST2._handle_nonbonded" title="Link to this definition">¶</a></dt>
<dd><p>Handle the nonbonded interactions defined in the new and old systems.
k_rest2 = T_cold / T_hot</p>
<section id="coulomb">
<h3>Coulomb<a class="headerlink" href="#coulomb" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><dl class="simple">
<dt>Old atoms (atoms that only show in state A).</dt><dd><p>chg = chgA * (1-λ) * k_rest2_sqrt
One offsets are needed:</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>New atoms (atoms that only show in state B).</dt><dd><p>chg = chgB * λ * k_rest2_sqrt
One offset is needed:</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Core atoms (atoms that are present in both states A and B).</dt><dd><p>chg = (chgA * (1-λ) + chgB * λ) * k_rest2_sqrt
= chgA * (1-λ) * k_rest2_sqrt + chgB * λ * k_rest2_sqrt
Two offsets are needed:</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>EnvH atoms (atoms that are not alchemically modified, but included in hot region).</dt><dd><p>chg = chg * k_rest2_sqrt
One offset is needed:</p>
</dd>
</dl>
</li>
<li><p>remove all 1-4 involving hot atoms</p></li>
</ol>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>X</p></th>
<th class="head"><p>param</p></th>
<th class="head"><p>math</p></th>
<th class="head"><p>chargeScale</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Old</p></td>
<td><p>lam_ele_del_x_k_rest2_sqrt</p></td>
<td><p>(1-λ) * k_rest2_sqrt</p></td>
<td><p>chgA</p></td>
</tr>
<tr class="row-odd"><td><p>New</p></td>
<td><p>lam_ele_ins_x_k_rest2_sqrt</p></td>
<td><p>λ     * k_rest2_sqrt</p></td>
<td><p>chgB</p></td>
</tr>
<tr class="row-even"><td><p>Core</p></td>
<td><p>lam_ele_coreA_x_k_rest2_sqrt</p></td>
<td><p>(1-λ) * k_rest2_sqrt</p></td>
<td><p>chgA</p></td>
</tr>
<tr class="row-odd"><td><p>Core</p></td>
<td><p>lam_ele_coreB_x_k_rest2_sqrt</p></td>
<td><p>λ     * k_rest2_sqrt</p></td>
<td><p>chgB</p></td>
</tr>
<tr class="row-even"><td><p>EnvH</p></td>
<td><p>k_rest2_sqrt</p></td>
<td><p>k_rest2_sqrt</p></td>
<td><p>chg</p></td>
</tr>
</tbody>
</table>
</section>
<section id="vdw">
<h3>vdW<a class="headerlink" href="#vdw" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt>NonbondedForce</dt><dd><p>env-env vdW</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>CustomNonbondedForce</dt><dd><p>non env-env vdW. U_rest2 = U_sterics*k_rest2_sqrt^(is_hot1+is_hot2)</p>
</dd>
</dl>
</li>
</ul>
</section>
</dd></dl>

</section>
</dd></dl>

</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2025, Chenggong Hui.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/utils.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/huichenggong/GrandFEP" class="github">
        <img src="_static/github-banner.svg" alt="Fork me on GitHub" class="github"/>
    </a>
    

    
  </body>
</html>