<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>NoneqGrandCanonicalMonteCarloSampler &#8212; GrandFEP  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=3f530b75" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=fd3c8104" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NoneqGrandCanonicalMonteCarloSamplerMPI" href="NoneqGrandCanonicalMonteCarloSamplerMPI.html" />
    <link rel="prev" title="BaseGrandCanonicalMonteCarloSampler" href="BaseGrandCanonicalMonteCarloSampler.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">GrandFEP</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=huichenggong&repo=GrandFEP&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../modules.html">GrandFEP API</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../sampler.html">sampler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html">utils</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../commandline.html">GrandFEP CLI</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../modules.html">GrandFEP API</a><ul>
  <li><a href="../sampler.html">sampler</a><ul>
      <li>Previous: <a href="BaseGrandCanonicalMonteCarloSampler.html" title="previous chapter">BaseGrandCanonicalMonteCarloSampler</a></li>
      <li>Next: <a href="NoneqGrandCanonicalMonteCarloSamplerMPI.html" title="next chapter">NoneqGrandCanonicalMonteCarloSamplerMPI</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="noneqgrandcanonicalmontecarlosampler">
<h1>NoneqGrandCanonicalMonteCarloSampler<a class="headerlink" href="#noneqgrandcanonicalmontecarlosampler" title="Link to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">grandfep.sampler.</span></span><span class="sig-name descname"><span class="pre">NoneqGrandCanonicalMonteCarloSampler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">system</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">temperature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collision_rate</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestep</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">platform=&lt;openmm.openmm.Platform;</span> <span class="pre">proxy</span> <span class="pre">of</span> <span class="pre">&lt;Swig</span> <span class="pre">Object</span> <span class="pre">of</span> <span class="pre">type</span> <span class="pre">'OpenMM::Platform</span> <span class="pre">*'&gt;</span> <span class="pre">&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_resname='HOH'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_O_name='O'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chemical_potential=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">standard_volume=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sphere_radius=Quantity(value=10.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unit=angstrom)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reference_atoms=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rst_file='md.rst7'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dcd_file=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">append_dcd=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jsonl_file='md.jsonl'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_split_water='log'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="BaseGrandCanonicalMonteCarloSampler.html#grandfep.sampler.BaseGrandCanonicalMonteCarloSampler" title="grandfep.sampler.base.BaseGrandCanonicalMonteCarloSampler"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseGrandCanonicalMonteCarloSampler</span></code></a></p>
<p>Nonequilibrium Grand Canonical Monte Carlo (Noneq-GCMC) sampler.</p>
<p>In this class, GCMC is achieved by performing insertion/deletion in a nonequilibrium candidate Monte Carlo manner.
The work value of the insertion/deletion will be used to evaluate the acceptance ratio. Insertion/deletion can
either be performed in the whole box or in a sub-volume (active site) of the box. In an equilibrium sampling, when
the water is free to move in/out of the sub-volume, I recommend alternating between GCMC and box.</p>
<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.get_particle_parameter_index_cust_nb_force">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_particle_parameter_index_cust_nb_force</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">custom_nonbonded_force</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.get_particle_parameter_index_cust_nb_force" title="Link to this definition">¶</a></dt>
<dd><p>Get the indices of <cite>is_real</cite> and <cite>is_switching</cite> parameters in the perParticleParameters
of <cite>self.custom_nonbonded_force</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>custom_nonbonded_force</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.openmm.CustomNonbondedForce</span></code></span>) – The CustomNonbondedForce to be checked.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple <cite>(is_real_index, is_switching_index)</cite> indicating the indices of the corresponding
parameters in <cite>self.custom_nonbonded_force.getPerParticleParameterName(i)</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">system</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">topology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">temperature</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">collision_rate</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timestep</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">platform=&lt;openmm.openmm.Platform;</span> <span class="pre">proxy</span> <span class="pre">of</span> <span class="pre">&lt;Swig</span> <span class="pre">Object</span> <span class="pre">of</span> <span class="pre">type</span> <span class="pre">'OpenMM::Platform</span> <span class="pre">*'&gt;</span> <span class="pre">&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_resname='HOH'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_O_name='O'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">position=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chemical_potential=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">standard_volume=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sphere_radius=Quantity(value=10.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unit=angstrom)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reference_atoms=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rst_file='md.rst7'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dcd_file=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">append_dcd=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jsonl_file='md.jsonl'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_split_water='log'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.__init__" title="Link to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>system</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.openmm.System</span></code></span>) – The OpenMM System object. Must include <cite>CustomNonbondedForce</cite> and <cite>NonbondedForce</cite> with
appropriate per-particle parameters and global parameter definitions. Call <code class="docutils literal notranslate"><span class="pre">system.setDefaultPeriodicBoxVectors()</span></code>
before passing it to this class, the newly created context will use this box vectors. Only a rectangular box
is supported.</p></li>
<li><p><strong>topology</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.app.topology.Topology</span></code></span>) – The OpenMM Topology object. Must contain water molecules with the specified residue and atom names. Must have
the correct boxVector. Only a rectangular box is supported.</p></li>
<li><p><strong>temperature</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code></span>) – The reference temperature for the system, with proper units (e.g., kelvin).</p></li>
<li><p><strong>collision_rate</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code></span>) – The collision rate (friction) for the Langevin integrator, with time units.</p></li>
<li><p><strong>timestep</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code></span>) – The timestep for the integrator, with time units (e.g., femtoseconds).</p></li>
<li><p><strong>log</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code>]</span>) – Path to the log file. This file will be opened in appended mode.</p></li>
<li><p><strong>platform</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.openmm.Platform</span></code></span>) – The OpenMM computational platform to use. Default is CUDA.</p></li>
<li><p><strong>water_resname</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – The residue name of water in the topology. Default is ‘HOH’.</p></li>
<li><p><strong>water_O_name</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – The atom name of oxygen in water. Default is ‘O’.</p></li>
<li><p><strong>position</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code></span>) – Initial position of the system. Need to be provided for box Vectors. Default is None.</p></li>
<li><p><strong>chemical_potential</strong> – Chemical potential of the system, with units. Default is None.</p></li>
<li><p><strong>standard_volume</strong> – Standard volume of a water molecule in the reservoir. with units. Default is None.</p></li>
<li><p><strong>sphere_radius</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code></span>) – Radius of the GCMC sphere. Default is 10.0 * unit.angstroms.</p></li>
<li><p><strong>reference_atoms</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></span>) – A list of atom indices in the topology that will be set as the center of the GCMC sphere. Default is None.</p></li>
<li><p><strong>rst_file</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – File name for the restart file.</p></li>
<li><p><strong>dcd_file</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – File name for the DCD trajectory file. Default is None, no DCD reporter.</p></li>
<li><p><strong>append_dcd</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span>) – Whether to append to the DCD file. Default is True.</p></li>
<li><p><strong>jsonl_file</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></span>) – File name for the JSONL file. Default is “md.jsonl”. This file saves the ghost_list. rst7 file needs this jsonl
to restart the ghost list, and dcd file needs this jsonl to remove the ghost water.</p></li>
<li><p><strong>n_split_water</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>]</span>) – Number of split water for Hybrid_REST2 system. If ‘log’, will use log10(N_water).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.check_ghost_list">
<span class="sig-name descname"><span class="pre">check_ghost_list</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.check_ghost_list" title="Link to this definition">¶</a></dt>
<dd><p>Loop over all water particles in the system to validate that <cite>self.ghost_list</cite> correctly reflects
the current ghost and switching water configuration.</p>
<ul class="simple">
<li><dl class="simple">
<dt>Ghost water:</dt><dd><ol class="arabic simple">
<li><p><cite>is_real = 0.0</cite> and <cite>is_switching = 0.0</cite> in every CustomNonbondedForce in <cite>self.custom_nonbonded_force_dict</cite></p></li>
<li><p>Charge = 0.0 in <cite>self.nonbonded_force</cite></p></li>
</ol>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Real and not switching water:</dt><dd><ol class="arabic simple">
<li><p><cite>is_real = 1.0</cite> in every CustomNonbondedForce in <cite>self.custom_nonbonded_force_dict</cite></p></li>
<li><p>Charge = Proper_water_charge in <cite>self.nonbonded_force</cite></p></li>
</ol>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Switching water:</dt><dd><ol class="arabic simple">
<li><p><cite>is_real = 1.0</cite> in every CustomNonbondedForce in <cite>self.custom_nonbonded_force_dict</cite></p></li>
<li><p>Charge = 0.0 in <cite>self.nonbonded_force</cite></p></li>
</ol>
</dd>
</dl>
</li>
</ul>
<p>The switching water should not be present in <cite>self.ghost_list</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If any condition for ghost, real, or switching water is violated.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.check_switching">
<span class="sig-name descname"><span class="pre">check_switching</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.check_switching" title="Link to this definition">¶</a></dt>
<dd><p>Loop over all water particles in the system to make sure the one water given by self.switching_water is the
only one that is switching.</p>
<ul class="simple">
<li><dl class="simple">
<dt>Switching water:</dt><dd><ol class="arabic simple">
<li><p><cite>is_real = 1.0</cite> and <cite>is_switching = 1.0</cite> in <cite>self.custom_nonbonded_force</cite></p></li>
<li><p>Charge = 0.0 in <cite>self.nonbonded_force</cite> (ParticleParameters)</p></li>
<li><p><cite>chargeScale = proper_water_charge</cite> in <cite>ParticleParameterOffsets</cite></p></li>
</ol>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Non-switching waters:</dt><dd><ol class="arabic simple">
<li><p><cite>is_switching = 0.0</cite> in <cite>self.custom_nonbonded_force</cite></p></li>
<li><p>No <cite>ParticleParameterOffsets</cite> in <cite>self.nonbonded_force</cite></p></li>
</ol>
</dd>
</dl>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If any switching or non-switching water fails to meet the expected criteria.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.customise_force_amber">
<span class="sig-name descname"><span class="pre">customise_force_amber</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">system</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.customise_force_amber" title="Link to this definition">¶</a></dt>
<dd><p>In Amber, NonbondedForce handles both electrostatics and vdW. This function will remove vdW from NonbondedForce
and create a list of CustomNonbondedForce (in this case, only 1 in the list) to handle vdW, so that the
interaction can be switched off for certain water.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>system</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.openmm.System</span></code></span>) – openmm.System
The system to be converted.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.customise_force_charmm">
<span class="sig-name descname"><span class="pre">customise_force_charmm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">system</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.customise_force_charmm" title="Link to this definition">¶</a></dt>
<dd><p>In Charmm, NonbondedForce handles electrostatics, and CustomNonbondedForce handles vdW. For vdW, this function will add
perParticle parameters ‘is_real’, ‘is_switching’, global parameter <code class="docutils literal notranslate"><span class="pre">lambda_gc_vdw</span></code> to the CustomNonbondedForce.
For Coulomb, this function will add ParticleParameterOffset to the switching water and <code class="docutils literal notranslate"><span class="pre">lambda_gc_coulomb</span></code>
to the NonbondedForce.</p>
<dl class="simple">
<dt>The CustomNonbondedForce should have the following energy expression:</dt><dd><p>‘(a/r6)^2-b/r6; r6=r^6;a=acoef(type1, type2);b=bcoef(type1, type2)’
or
‘acoef(type1, type2)/r^12 - bcoef(type1, type2)/r^6;’</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>system</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.openmm.System</span></code></span>) – openmm.System
The system to be converted.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.customise_force_hybrid">
<span class="sig-name descname"><span class="pre">customise_force_hybrid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">system</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.customise_force_hybrid" title="Link to this definition">¶</a></dt>
<dd><p>If the system is Hybrid, this function will add perParticleParameters <code class="docutils literal notranslate"><span class="pre">is_real</span></code> and <code class="docutils literal notranslate"><span class="pre">is_switching</span></code>
to the custom_nonbonded_force (openmm.openmm.CustomNonbondedForce) for vdw.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Groups</p></th>
<th class="head"><p>old</p></th>
<th class="head"><p>core</p></th>
<th class="head"><p>new</p></th>
<th class="head"><p>fix</p></th>
<th class="head"><p>wat</p></th>
<th class="head"><p>swit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>old</p></td>
<td><p>C1</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>core</p></td>
<td><p>C1</p></td>
<td><p>C1</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>new</p></td>
<td><p>None</p></td>
<td><p>C1</p></td>
<td><p>C1</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>fix</p></td>
<td><p>C1</p></td>
<td><p>C1</p></td>
<td><p>C1</p></td>
<td><p>C4</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>wat</p></td>
<td><p>C1</p></td>
<td><p>C1</p></td>
<td><p>C1</p></td>
<td><p>C3</p></td>
<td><p>C3</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>swit</p></td>
<td><p>C1</p></td>
<td><p>C1</p></td>
<td><p>C1</p></td>
<td><p>C2</p></td>
<td><p>C2</p></td>
<td><p>C2</p></td>
</tr>
</tbody>
</table>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>system</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.openmm.System</span></code></span>) – The system to be converted.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.customise_force_hybridREST2">
<span class="sig-name descname"><span class="pre">customise_force_hybridREST2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">system</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimization</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_split</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'log'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.customise_force_hybridREST2" title="Link to this definition">¶</a></dt>
<dd><p>If the system is Hybrid, this function will add perParticleParameters <code class="docutils literal notranslate"><span class="pre">is_real</span></code> and <code class="docutils literal notranslate"><span class="pre">is_switching</span></code>
to the custom_nonbonded_force (openmm.openmm.CustomNonbondedForce) for vdw.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Groups</p></th>
<th class="head"><p>core</p></th>
<th class="head"><p>new</p></th>
<th class="head"><p>old</p></th>
<th class="head"><p>envh</p></th>
<th class="head"><p>envc</p></th>
<th class="head"><p>wat</p></th>
<th class="head"><p>swit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0 core</p></td>
<td><p>C_alc</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>1 new</p></td>
<td><p>C_alc</p></td>
<td><p>C_alc</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>2 old</p></td>
<td><p>C_alc</p></td>
<td><p>None</p></td>
<td><p>C_alc</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>3 envh</p></td>
<td><p>C_alc</p></td>
<td><p>C_alc</p></td>
<td><p>C_alc</p></td>
<td><p>NonB</p></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>4 envc</p></td>
<td><p>C_alc</p></td>
<td><p>C_alc</p></td>
<td><p>C_alc</p></td>
<td><p>NonB</p></td>
<td><p>NonB</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>5 wat</p></td>
<td><p>C_alc</p></td>
<td><p>C_alc</p></td>
<td><p>C_alc</p></td>
<td><p>C_wat1</p></td>
<td><p>C_wat2</p></td>
<td><p>C_wat3</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>6 swit</p></td>
<td><p>C_alc</p></td>
<td><p>C_alc</p></td>
<td><p>C_alc</p></td>
<td><p>C_alc</p></td>
<td><p>C_alc</p></td>
<td><p>C_alc</p></td>
<td><p>C_alc</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><dl class="simple">
<dt>C_alc</dt><dd><p>CustomNonbondedForce for Alchemical atoms</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>C_wat1</dt><dd><p>CustomNonbondedForce for</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>C_wat2</dt><dd><p>CustomNonbondedForce for</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>C_wat3</dt><dd><p>CustomNonbondedForce for</p>
</dd>
</dl>
</li>
</ul>
<p>The most basic energy expression for vdw is the following. All the other forces are simplified from this one.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">energy</span>  <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 2</span>    <span class="s2">&quot;U_rest2;&quot;</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>    <span class="c1"># 9. REST2</span>
<span class="linenos"> 5</span>    <span class="s2">&quot;U_rest2 = U_sterics * k_rest2_sqrt^is_hot;&quot;</span>
<span class="linenos"> 6</span>    <span class="s2">&quot;is_hot = step(3-atom_group1) + step(3-atom_group2);&quot;</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>    <span class="c1"># 8. vdw with 1. switching water 2. water real/dummy</span>
<span class="linenos"> 9</span>    <span class="s2">&quot;U_sterics = 4*epsilon*x*(x-1.0) * lambda_gc * is_real1 * is_real2;&quot;</span>
<span class="linenos">10</span>
<span class="linenos">11</span>    <span class="c1"># 7. introduce softcore when new/old/switching atoms are involved</span>
<span class="linenos">12</span>    <span class="s2">&quot;x = 1 / ((softcore_alpha*lambda_alpha + (r/sigma)^6));&quot;</span>
<span class="linenos">13</span>    <span class="s2">&quot;lambda_alpha = (new_X*(1-lambda_sterics_insert) + old_X*lambda_sterics_delete + swit_X*lambda_gc_vdw) / (swit_X + 1);&quot;</span>
<span class="linenos">14</span>
<span class="linenos">15</span>    <span class="c1"># 6. Interpolating between states A and B</span>
<span class="linenos">16</span>    <span class="s2">&quot;epsilon = (1-lambda_sterics)*epsilonA + lambda_sterics*epsilonB;&quot;</span>
<span class="linenos">17</span>    <span class="s2">&quot;sigma = (1-lambda_sterics)*sigmaA + lambda_sterics*sigmaB;&quot;</span>
<span class="linenos">18</span>
<span class="linenos">19</span>    <span class="c1"># 5. select lambda</span>
<span class="linenos">20</span>    <span class="s2">&quot;lambda_sterics = (new_X*lambda_sterics_insert + old_X*lambda_sterics_delete + core_cew*lambda_sterics_core);&quot;</span> <span class="c1"># only one lambda_XXX will take effect</span>
<span class="linenos">21</span>    <span class="s2">&quot;lambda_gc = ((1 - swit_X) + lambda_gc_vdw * swit_X);&quot;</span> <span class="c1"># if swit_X=0 -&gt; lambda_gc=1, if swit_X=1 -&gt; lambda_gc=lambda_gc_vdw</span>
<span class="linenos">22</span>
<span class="linenos">23</span>    <span class="c1"># 4. determine interaction types</span>
<span class="linenos">24</span>    <span class="s2">&quot;swit_X   = max(is_swit1, is_swit2);&quot;</span>
<span class="linenos">25</span>    <span class="s2">&quot;core_cew = delta(old_X + new_X);&quot;</span>    <span class="c1"># core-core + core-envh + core-envc + core-wat + core-swit</span>
<span class="linenos">26</span>    <span class="s2">&quot;new_X    = max(is_new1, is_new2);&quot;</span>
<span class="linenos">27</span>    <span class="s2">&quot;old_X    = max(is_old1, is_old2);&quot;</span>
<span class="linenos">28</span>
<span class="linenos">29</span>    <span class="c1"># 3. determine atom groups</span>
<span class="linenos">30</span>    <span class="c1">## 3.1 check atom1</span>
<span class="linenos">31</span>    <span class="s2">&quot;is_core1 = delta(0-atom_group1);&quot;</span>
<span class="linenos">32</span>    <span class="s2">&quot;is_new1  = delta(1-atom_group1);&quot;</span>
<span class="linenos">33</span>    <span class="s2">&quot;is_old1  = delta(2-atom_group1);&quot;</span>
<span class="linenos">34</span>    <span class="s2">&quot;is_envh1 = delta(3-atom_group1);&quot;</span>
<span class="linenos">35</span>    <span class="s2">&quot;is_envc1 = delta(4-atom_group1);&quot;</span>
<span class="linenos">36</span>    <span class="s2">&quot;is_wat1  = delta(5-atom_group1);&quot;</span>
<span class="linenos">37</span>    <span class="s2">&quot;is_swit1 = delta(6-atom_group1);&quot;</span>
<span class="linenos">38</span>    <span class="c1">## 3.2 check atom2</span>
<span class="linenos">39</span>    <span class="s2">&quot;is_core2 = delta(0-atom_group2);&quot;</span>
<span class="linenos">40</span>    <span class="s2">&quot;is_new2  = delta(1-atom_group2);&quot;</span>
<span class="linenos">41</span>    <span class="s2">&quot;is_old2  = delta(2-atom_group2);&quot;</span>
<span class="linenos">42</span>    <span class="s2">&quot;is_envh2 = delta(3-atom_group2);&quot;</span>
<span class="linenos">43</span>    <span class="s2">&quot;is_envc2 = delta(4-atom_group2);&quot;</span>
<span class="linenos">44</span>    <span class="s2">&quot;is_wat2  = delta(5-atom_group2);&quot;</span>
<span class="linenos">45</span>    <span class="s2">&quot;is_swit2 = delta(6-atom_group2);&quot;</span>
<span class="linenos">46</span>
<span class="linenos">47</span>    <span class="c1"># 1. LJ mixing rules</span>
<span class="linenos">48</span>    <span class="s2">&quot;epsilonA = sqrt(epsilonA1*epsilonA2);&quot;</span>
<span class="linenos">49</span>    <span class="s2">&quot;epsilonB = sqrt(epsilonB1*epsilonB2);&quot;</span>
<span class="linenos">50</span>    <span class="s2">&quot;sigmaA = 0.5*(sigmaA1 + sigmaA2);&quot;</span>
<span class="linenos">51</span>    <span class="s2">&quot;sigmaB = 0.5*(sigmaB1 + sigmaB2);&quot;</span>
<span class="linenos">52</span>    <span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>system</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.openmm.System</span></code></span>) – The system to be converted.</p></li>
<li><p><strong>optimization</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-data docutils literal notranslate"><span class="pre">typing.Literal</span></code>[<code class="docutils literal notranslate"><span class="pre">'O3'</span></code>, <code class="docutils literal notranslate"><span class="pre">'O1'</span></code>]</span>) – Level of optimization. It can be <cite>O3</cite> or <cite>O1</cite>. When <cite>O3</cite> is selected, We will try to hard code sigma and epsilon
into the energy expression for wat-wat interaction if there is only one water atom has LJ. This can be applied to
TIP3P, OPC. <cite>O3</cite> will make no difference if charmm TIP3P is used, because H also has LJ parameters.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.get_ghost_list">
<span class="sig-name descname"><span class="pre">get_ghost_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">check_system</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.get_ghost_list" title="Link to this definition">¶</a></dt>
<dd><p>Get a copy of the current ghost water list.</p>
<p>If <cite>check_system</cite> is True, <cite>self.check_ghost_list</cite> will be called to validate the consistency of self.ghost_list
with <cite>self.custom_nonbonded_force</cite> and <cite>self.nonbonded_force</cite>. If the validation fails,
a ValueError will be raised.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>check_system</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></span>) – If True, self.check_ghost_list() will be called to perform consistency checks in the system forces
to ensure that the ghost list is correct.
Default is False.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A copy of <cite>self.ghost_list</cite>, which contains the residue indices of ghost waters.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.get_particle_parameter_offset_dict">
<span class="sig-name descname"><span class="pre">get_particle_parameter_offset_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.get_particle_parameter_offset_dict" title="Link to this definition">¶</a></dt>
<dd><p>Retrieve all <cite>ParticleParameterOffset</cite> entries from <cite>self.nonbonded_force</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><p>A dictionary mapping atom indices to their corresponding <cite>ParticleParameterOffset</cite> data.</p>
<p>The key is the atom index. Each value is a list with the following structure:
[
param_offset_index,
global_parameter_name,
atom_index,
chargeScale,
sigmaScale,
epsilonScale
]</p>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.get_sphere_center">
<span class="sig-name descname"><span class="pre">get_sphere_center</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">positions</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.get_sphere_center" title="Link to this definition">¶</a></dt>
<dd><p>Average the reference atoms positions</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>sphere_center</strong> – The center of the GCMC sphere, with unit</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>unit.Quantity</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.get_water_state">
<span class="sig-name descname"><span class="pre">get_water_state</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">positions</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.get_water_state" title="Link to this definition">¶</a></dt>
<dd><p>Check whether the water molecule is inside the box (1) or not (0).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>positions</strong> (<em>unit.Quantity</em>) – The current positions of the system.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.array</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>water_state_dict</strong> (<em>dict</em>) – A dictionary label whether the water molecule is inside the sphere (1) or not (0).</p></li>
<li><p><strong>dist_all_o</strong> (<em>np.array</em>) – The distance between all the water oxygen and the center of the sphere. Value in nanometers.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.load_rst">
<span class="sig-name descname"><span class="pre">load_rst</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rst_input</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.load_rst" title="Link to this definition">¶</a></dt>
<dd><p>Load positions/velocities from a restart file. boxVector will be checked, if not match, raise an error.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>rst_input</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>Path</em><em>]</em>) – Amber inpcrd file</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.move_deletion_GCMC">
<span class="sig-name descname"><span class="pre">move_deletion_GCMC</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">l_vdw_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l_chg_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_prop</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.move_deletion_GCMC" title="Link to this definition">¶</a></dt>
<dd><p>Perform a non-equilibrium deletion, according the given lambda schedule</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>l_vdw_list</strong> (<em>list</em>) – A list of <code class="docutils literal notranslate"><span class="pre">lambda_gc_vdw</span></code> value that defines the path of insertion. It should start with 1.0 and end with 0.0.</p></li>
<li><p><strong>l_chg_list</strong> (<em>list</em>) – A list of <code class="docutils literal notranslate"><span class="pre">lambda_gc_coulomb</span></code> value that defines the path of insertion. It should start with 1.0 and end with 0.0.</p></li>
<li><p><strong>n_prop</strong> (<em>int</em>) – Number of propagation steps (equilibrium MD) between each lambda switching.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>accept</strong> (<em>bool</em>) – Whether the insertion is accepted.</p></li>
<li><p><strong>acc_prob</strong> (<em>float</em>) – The acceptance probability of the insertion.</p></li>
<li><p><strong>protocol_work</strong> (<em>unit.Quantity</em>) – The work done during the insertion process, with unit.</p></li>
<li><p><strong>protocol_work_list</strong> (<em>list</em>) – A list of work values during each perturbation step, in kcal/mol. no unit in this list.</p></li>
<li><p><strong>n_water</strong> (<em>int</em>) – The number of water molecules in the system after the insertion.</p></li>
<li><p><strong>switching_water_inside</strong> (<em>bool</em>) – Whether the swithching water is inside the GCMC sphere in the end point of non-eq process</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.move_deletion_box">
<span class="sig-name descname"><span class="pre">move_deletion_box</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">l_vdw_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l_chg_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_prop</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.move_deletion_box" title="Link to this definition">¶</a></dt>
<dd><p>Perform a non-equilibrium deletion, according the given lambda schedule</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>l_vdw_list</strong> (<em>list</em>) – A list of <code class="docutils literal notranslate"><span class="pre">lambda_gc_vdw</span></code> value that defines the path of insertion. It should start with 1.0 and end with 0.0.</p></li>
<li><p><strong>l_chg_list</strong> (<em>list</em>) – A list of <code class="docutils literal notranslate"><span class="pre">lambda_gc_coulomb</span></code> value that defines the path of insertion. It should start with 1.0 and end with 0.0.</p></li>
<li><p><strong>n_prop</strong> (<em>int</em>) – Number of propagation steps (equilibrium MD) between each lambda switching.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>accept</strong> (<em>bool</em>) – Whether the insertion is accepted.</p></li>
<li><p><strong>acc_prob</strong> (<em>float</em>) – The acceptance probability of the insertion.</p></li>
<li><p><strong>protocol_work</strong> (<em>unit.Quantity</em>) – The work done during the insertion process, with unit.</p></li>
<li><p><strong>protocol_work_list</strong> (<em>list</em>) – A list of work values during each perturbation step, in kcal/mol. no unit in this list.</p></li>
<li><p><strong>n_water</strong> (<em>int</em>) – The number of water molecules in the system after the insertion.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.move_insert_delete">
<span class="sig-name descname"><span class="pre">move_insert_delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">l_vdw_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l_chg_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_prop</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">box</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.move_insert_delete" title="Link to this definition">¶</a></dt>
<dd><p>Randomly do insertion or deletion in 1:1 probability</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>l_vdw_list</strong> (<em>list</em>) – A list of <code class="docutils literal notranslate"><span class="pre">lambda_gc_vdw</span></code> value that defines the path of insertion. It should start with 0.0 and end with 1.0.</p></li>
<li><p><strong>l_chg_list</strong> (<em>list</em>) – A list of <code class="docutils literal notranslate"><span class="pre">lambda_gc_coulomb</span></code> value that defines the path of insertion. It should start with 0.0 and end with 1.0.</p></li>
<li><p><strong>n_prop</strong> (<em>int</em>) – Number of propagation steps (equilibrium MD) between each lambda switching.</p></li>
<li><p><strong>box</strong> (<em>bool</em>) – GC in box or GCMC sphere</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>accept</strong> (<em>bool</em>) – Whether the insertion is accepted.</p></li>
<li><p><strong>acc_prob</strong> (<em>float</em>) – The acceptance probability of the insertion.</p></li>
<li><p><strong>protocol_work</strong> (<em>unit.Quantity</em>) – The work done during the insertion process, with unit.</p></li>
<li><p><strong>protocol_work_list</strong> (<em>list</em>) – A list of work values during each perturbation step, in kcal/mol. no unit in this list.</p></li>
<li><p><strong>n_water</strong> (<em>int</em>) – The number of water molecules in the system after the insertion.</p></li>
<li><p><strong>switching_water_inside</strong> (<em>bool</em>) – Whether the swithching water is inside reasonable region in the end point of non-eq process</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.move_insertion_GCMC">
<span class="sig-name descname"><span class="pre">move_insertion_GCMC</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">l_vdw_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l_chg_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_prop</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.move_insertion_GCMC" title="Link to this definition">¶</a></dt>
<dd><p>Perform a non-equilibrium insertion, according the given lambda schedule</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>l_vdw_list</strong> (<em>list</em>) – A list of <code class="docutils literal notranslate"><span class="pre">lambda_gc_vdw</span></code> value that defines the path of insertion. It should start with 0.0 and end with 1.0.</p></li>
<li><p><strong>l_chg_list</strong> (<em>list</em>) – A list of <code class="docutils literal notranslate"><span class="pre">lambda_gc_coulomb</span></code> value that defines the path of insertion. It should start with 0.0 and end with 1.0.</p></li>
<li><p><strong>n_prop</strong> (<em>int</em>) – Number of propagation steps (equilibrium MD) between each lambda switching.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>accept</strong> (<em>bool</em>) – Whether the insertion is accepted.</p></li>
<li><p><strong>acc_prob</strong> (<em>float</em>) – The acceptance probability of the insertion.</p></li>
<li><p><strong>protocol_work</strong> (<em>unit.Quantity</em>) – The work done during the insertion process, with unit.</p></li>
<li><p><strong>protocol_work_list</strong> (<em>list</em>) – A list of work values during each perturbation step, in kcal/mol. no unit in this list.</p></li>
<li><p><strong>n_water</strong> (<em>int</em>) – The number of water molecules in the system after the insertion.</p></li>
<li><p><strong>switching_water_inside</strong> (<em>bool</em>) – Whether the swithching water is inside the GCMC sphere in the end point of non-eq process</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.move_insertion_box">
<span class="sig-name descname"><span class="pre">move_insertion_box</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">l_vdw_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l_chg_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_prop</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.move_insertion_box" title="Link to this definition">¶</a></dt>
<dd><p>Perform a non-equilibrium insertion, according the given lambda schedule</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>l_vdw_list</strong> (<em>list</em>) – A list of <code class="docutils literal notranslate"><span class="pre">lambda_gc_vdw</span></code> value that defines the path of insertion. It should start with 0.0 and end with 1.0.</p></li>
<li><p><strong>l_chg_list</strong> (<em>list</em>) – A list of <code class="docutils literal notranslate"><span class="pre">lambda_gc_coulomb</span></code> value that defines the path of insertion. It should start with 0.0 and end with 1.0.</p></li>
<li><p><strong>n_prop</strong> (<em>int</em>) – Number of propagation steps (equilibrium MD) between each lambda switching.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>accept</strong> (<em>bool</em>) – Whether the insertion is accepted.</p></li>
<li><p><strong>acc_prob</strong> (<em>float</em>) – The acceptance probability of the insertion.</p></li>
<li><p><strong>protocol_work</strong> (<em>unit.Quantity</em>) – The work done during the insertion process, with unit.</p></li>
<li><p><strong>protocol_work_list</strong> (<em>list</em>) – A list of work values during each perturbation step, in kcal/mol. no unit in this list.</p></li>
<li><p><strong>n_water</strong> (<em>int</em>) – The number of water molecules in the system after the insertion.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.random_place_water">
<span class="sig-name descname"><span class="pre">random_place_water</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">res_index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sphere_center</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.random_place_water" title="Link to this definition">¶</a></dt>
<dd><p>Shift the coordinate+orientation of a water molecule to a random place. If the center is None, a random position
in the box will be selected. If the center is not None, a randomed position in the GCMC sphere will be selected.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> (<em>openmm.State</em>) – The current state of the simulation context. The positions will be read from this state.</p></li>
<li><p><strong>res_index</strong> (<em>int</em>) – The residue index of the water molecule to be shifted.</p></li>
<li><p><strong>sphere_center</strong> (<em>unit.Quantity</em>) – The center of the GCMC sphere. If None, a random position in the box will be selected. Default is None.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>positions</strong> (<em>unit.Quantity</em>) – The new positions with the water molecule shifted.</p></li>
<li><p><strong>velocities</strong> (<em>unit.Quantity</em>) – The new velocities with the water molecule shifted.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.report_dcd">
<span class="sig-name descname"><span class="pre">report_dcd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.report_dcd" title="Link to this definition">¶</a></dt>
<dd><p>Append a frame to the DCD trajectory file. rst7, jsonl will be update at the same time. If state is not provided,
<code class="docutils literal notranslate"><span class="pre">self.simulation.context.getState(getPositions=True,</span> <span class="pre">getVelocities=True)</span></code> will be called to get a new state.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>state</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.openmm.State</span></code></span>) – State, which should have both Positions and Velocities. Default is None.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.report_jsonl">
<span class="sig-name descname"><span class="pre">report_jsonl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dcd</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.report_jsonl" title="Link to this definition">¶</a></dt>
<dd><p>Append a line to the jsonl file. An example line is like this. <code class="docutils literal notranslate"><span class="pre">GC_count</span></code> is the current number of GC step.
<code class="docutils literal notranslate"><span class="pre">ghost_list</span></code> is the ghost water residue 0-index. <code class="docutils literal notranslate"><span class="pre">dcd</span></code> tells whether there is a dcd frame saved with this
line of recording</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;GC_count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;ghost_list&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">],</span><span class="w"> </span><span class="nt">&quot;dcd&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dcd</strong> – Whether there is a dcd writing in this step for appending a line to jsonl. 1: yes, 0: no</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.report_rst">
<span class="sig-name descname"><span class="pre">report_rst</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dcd</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.report_rst" title="Link to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Write a rst7 restart file. If state is not provided,</dt><dd><p><code class="docutils literal notranslate"><span class="pre">self.simulation.context.getState(getPositions=True,</span> <span class="pre">getVelocities=True)</span></code> will be called to get a new state.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> – State, which should have both Positions and Velocities. Default is None.</p></li>
<li><p><strong>dcd</strong> – Whether there is a dcd writing in this step for appending a line to jsonl. 1: yes, 0: no</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.set_ghost_from_jsonl">
<span class="sig-name descname"><span class="pre">set_ghost_from_jsonl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">jsonl_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.set_ghost_from_jsonl" title="Link to this definition">¶</a></dt>
<dd><p>Read the last line of a jsonl file and set the current ghost_list,gc_count.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>jsonl_file</strong></p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.set_ghost_list">
<span class="sig-name descname"><span class="pre">set_ghost_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ghost_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">check_system</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.set_ghost_list" title="Link to this definition">¶</a></dt>
<dd><p>Update the water residues in <cite>ghost_list</cite> to ghost.</p>
<p>If <cite>check_system</cite> is True, <cite>self.check_ghost_list</cite> will be called to validate the consistency of self.ghost_list
with <cite>self.custom_nonbonded_force_list</cite> and <cite>self.nonbonded_force</cite>. If the validation fails,
a ValueError will be raised.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ghost_list</strong> (<em>list</em>) – A list of residue indices (integers) that should be marked as ghost waters.</p></li>
<li><p><strong>check_system</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, perform validation to ensure the internal force parameters are consistent with
the updated <cite>ghost_list</cite>. Default is True.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.update_gc_count">
<span class="sig-name descname"><span class="pre">update_gc_count</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">insert_delete</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">work</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">box_GCMC</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_water</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accept</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">acc_prob</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.update_gc_count" title="Link to this definition">¶</a></dt>
<dd><p>Update the internal <cite>gc_count</cite> dictionary that tracks GCMC insertion/deletion statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>insert_delete</strong> (<em>int</em>) – Indicator for the type of move: <cite>0</cite> for insertion, <cite>1</cite> for deletion.</p></li>
<li><p><strong>work</strong> (<em>unit.Quantity</em>) – Work value (e.g., from nonequilibrium switching), with units. The value in kcal/mol will be recorded.</p></li>
<li><p><strong>box_GCMC</strong> (<em>int</em>) – Region type indicator: <cite>0</cite> for the whole simulation box, <cite>1</cite> for a GCMC sub-volume.</p></li>
<li><p><strong>n_water</strong> (<em>int</em>) – Number of water molecules after this move in the whole box or in the GCMC sub-volume, depending on <cite>box_GCMC</cite>.</p></li>
<li><p><strong>accept</strong> (<em>bool</em>) – Indicator of whether the move was accepted</p></li>
<li><p><strong>acc_prob</strong> (<em>float</em>) – Acceptance probability.</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.work_process">
<span class="sig-name descname"><span class="pre">work_process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_prop</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l_vdw_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l_chg_list</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.work_process" title="Link to this definition">¶</a></dt>
<dd><p>Perform the work process for insertion/deletion.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n_prop</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></span>) – Number of propagation steps (equilibrium MD) between each lambda switching.</p></li>
<li><p><strong>l_vdw_list</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></span>) – A list of value for <code class="docutils literal notranslate"><span class="pre">lambda_gc_vdw</span></code>.</p></li>
<li><p><strong>l_chg_list</strong> (<span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code></span>) – A list of value for <code class="docutils literal notranslate"><span class="pre">lambda_gc_coulomb</span></code></p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><span class="sphinx_autodoc_typehints-type"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>]</span></p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>explosion</strong> (<em>bool</em>) – Whether the non-equilibrium process get nan.</p></li>
<li><p><strong>protocol_work</strong> (<em>unit.Quantity</em>) – The work done during the insertion process.</p></li>
<li><p><strong>protocol_work_list</strong> (<em>list</em>) – A list of work done during each perturbation step, in kcal/mol. no unit in this list.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.Adam_GCMC">
<span class="sig-name descname"><span class="pre">Adam_GCMC</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.Adam_GCMC" title="Link to this definition">¶</a></dt>
<dd><p>Adam value, considering the selected sphere and water molecules in the sphere.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.Adam_box">
<span class="sig-name descname"><span class="pre">Adam_box</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.Adam_box" title="Link to this definition">¶</a></dt>
<dd><p>Adam value, considering the whole simulation box and all water molecules.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.box_vectors">
<span class="sig-name descname"><span class="pre">box_vectors</span></span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.box_vectors" title="Link to this definition">¶</a></dt>
<dd><p>The box vectors of the system. The box has to be rectangular.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.chemical_potential">
<span class="sig-name descname"><span class="pre">chemical_potential</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.chemical_potential" title="Link to this definition">¶</a></dt>
<dd><p>Chemical potential of the GC particle.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.compound_integrator">
<span class="sig-name descname"><span class="pre">compound_integrator</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.openmm.CompoundIntegrator</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.compound_integrator" title="Link to this definition">¶</a></dt>
<dd><p>2 integrators in this attribute. The 1st one is for Canonical simulation, the 2nd one is for non-equilibirum insertion/deletion.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.custom_nonbonded_force_list">
<span class="sig-name descname"><span class="pre">custom_nonbonded_force_list</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code><span class="pre">[</span><code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code><span class="pre">]</span></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.custom_nonbonded_force_list" title="Link to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.ghost_list">
<span class="sig-name descname"><span class="pre">ghost_list</span></span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.ghost_list" title="Link to this definition">¶</a></dt>
<dd><p>A list of residue indices of water that are set to ghost. Should only be modified with set_ghost_list(), and get by get_ghost_list().</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.kBT">
<span class="sig-name descname"><span class="pre">kBT</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.kBT" title="Link to this definition">¶</a></dt>
<dd><p>k<sub>B</sub>* T, with unit.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.logger">
<span class="sig-name descname"><span class="pre">logger</span></span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.logger" title="Link to this definition">¶</a></dt>
<dd><p>Logger for the Sampler</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.nonbonded_force">
<span class="sig-name descname"><span class="pre">nonbonded_force</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.openmm.NonbondedForce</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.nonbonded_force" title="Link to this definition">¶</a></dt>
<dd><p>This force handles Coulomb. The switching water has ParticleParameterOffset with global parameter
<code class="docutils literal notranslate"><span class="pre">lambda_gc_coulomb</span></code> to control the switching water.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.num_of_points_water">
<span class="sig-name descname"><span class="pre">num_of_points_water</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.num_of_points_water" title="Link to this definition">¶</a></dt>
<dd><p>The number of points in the water model. 3 for TIP3P, 4 for OPC.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.reference_atoms">
<span class="sig-name descname"><span class="pre">reference_atoms</span></span><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.reference_atoms" title="Link to this definition">¶</a></dt>
<dd><p>A list of atom indices that will be set as the center of the GCMC sphere.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.simulation">
<span class="sig-name descname"><span class="pre">simulation</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.app.simulation.Simulation</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.simulation" title="Link to this definition">¶</a></dt>
<dd><p>Simulation ties together Topology, System, Integrator, and Context in this sampler.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.standard_volume">
<span class="sig-name descname"><span class="pre">standard_volume</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.standard_volume" title="Link to this definition">¶</a></dt>
<dd><p>Standard volume of a water molecule in the reservoir.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.switching_water">
<span class="sig-name descname"><span class="pre">switching_water</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.switching_water" title="Link to this definition">¶</a></dt>
<dd><p>The residue index of the switching water. The switching water will be set as the last water during initialization.
It should not be changed during the simulation, as the ParticleParameterOffset can not be updated in NonbondedForce.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.system">
<span class="sig-name descname"><span class="pre">system</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.openmm.System</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.system" title="Link to this definition">¶</a></dt>
<dd><p>The OpenMM System object.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.system_type">
<span class="sig-name descname"><span class="pre">system_type</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.system_type" title="Link to this definition">¶</a></dt>
<dd><p>The type of the system. Can be Amber, Charmm or Hybrid depending on the system and energy expression in the given CustomNonbondedForce.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.temperature">
<span class="sig-name descname"><span class="pre">temperature</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.unit.quantity.Quantity</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.temperature" title="Link to this definition">¶</a></dt>
<dd><p>The reference temperature for the system, with proper units (e.g., kelvin).</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.topology">
<span class="sig-name descname"><span class="pre">topology</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">openmm.app.topology.Topology</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.topology" title="Link to this definition">¶</a></dt>
<dd><p>The OpenMM Topology object. All the res_name, atom_index, atom_name, etc. are in this topology.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.wat_params">
<span class="sig-name descname"><span class="pre">wat_params</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.wat_params" title="Link to this definition">¶</a></dt>
<dd><p>A dictionary to track the nonbonded parameter of water. The keys are <code class="docutils literal notranslate"><span class="pre">charge</span></code>, <code class="docutils literal notranslate"><span class="pre">sigma</span></code>, <code class="docutils literal notranslate"><span class="pre">epsilon</span></code>,
The values are a list of parameters with unit.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.water_res_2_O">
<span class="sig-name descname"><span class="pre">water_res_2_O</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.water_res_2_O" title="Link to this definition">¶</a></dt>
<dd><p>A dictionary of residue index to the atom index of water oxygen.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.water_res_2_atom">
<span class="sig-name descname"><span class="pre">water_res_2_atom</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></em><a class="headerlink" href="#grandfep.sampler.NoneqGrandCanonicalMonteCarloSampler.water_res_2_atom" title="Link to this definition">¶</a></dt>
<dd><p>A dictionary of residue index to a list of atom indices of water.</p>
</dd></dl>

</dd></dl>

</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2025, Chenggong Hui.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../_sources/sampler/NoneqGrandCanonicalMonteCarloSampler.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/huichenggong/GrandFEP" class="github">
        <img src="../_static/github-banner.svg" alt="Fork me on GitHub" class="github"/>
    </a>
    

    
  </body>
</html>